<div class="dashboard">
  <div class="container-fluid">
    <b-card class="text-left users">
      <b-row>
        <b-col md="4">
          <h5>
            Users
            <span class="user-count">
              {{ users.length }} users
            </span>
          </h5>
        </b-col>
        <b-col md="8">
          <b-row class="pr-3 pt-3">
            <b-col cols="3" class="p-0">
              <b-input-group>
                <b-input-group-button class="left-icon-in-input">
                  <b-btn disabled>
                    <img src="~@/assets/images/full-size-user-mgmt-tools-icon.png" alt="">
                  </b-btn>
                </b-input-group-button>
                <b-form-select
                  v-model="sortBy"
                  :options="sortOptions"
                  class="input-with-left-icon"
                  @change="sortUsers">
                  <option slot="first" :value="null">Sort By</option>
                </b-form-select>
              </b-input-group>
            </b-col>
            <b-col cols="3" class="p-0">
              <b-input-group>
                <b-input-group-button class="left-icon-in-input">
                  <b-btn disabled>
                    <img src="~@/assets/images/full-size-user-mgmt-tools-icon.png" alt="">
                  </b-btn>
                </b-input-group-button>
                <b-form-select v-model="filterBy" :options="filterOptions" class="input-with-left-icon">
                  <option slot="first" :value="null">Filter By</option>
                </b-form-select>
              </b-input-group>
            </b-col>
            <b-col cols="6" class="p-0 pr-3">
              <b-input-group style="flex: 1 1 50%;">
                <b-form-input v-model="userFilter" placeholder="Search" style="border-radius: 3px;height: 38px;"/>
                <b-input-group-button class="icon-in-input">
                  <b-btn :disabled="!userFilter" @click="userFilter = ''">
                    <img src="~@/assets/images/full-size-user-mgmt-search-icon.png" alt="">
                  </b-btn>
                </b-input-group-button>
              </b-input-group>
            </b-col>
          </b-row>
        </b-col>
      </b-row>
      <div class="table-responsive">
        <b-table
          hover
          :items="users" 
          :fields="userHeaders" 
          :per-page="perUserPage"
          :current-page="currentUserPage"
          :filter="userFilter"
          :sort-by.sync="sortUser"
          :sort-desc.sync="sortUserDesc"
          @filtered="onUsersFiltered"
          class="mt-3 grey-table-head mb-5">
          <template slot="_id_scan_slot" slot-scope="data" class="scan_slot_class">
            <img :src="`data:image/png;base64,${data.item._id_scan}`" alt="">
          </template>
          <template slot="_id_selfie_slot" slot-scope="data">
            <img :src="`data:image/png;base64,${data.item._id_selfie}`" alt="">
          </template>
          <template slot="_actions" slot-scope="data">
            <b-link class="d-inline-block mr-1" href="#" @click="navigate('user',data.item.id)">
              <i class="fa fa-pencil"></i>
            </b-link>
            <b-link class="d-inline-block" href="#">
              <i class="fa fa-trash-o"></i>
            </b-link>
          </template>
        </b-table>
      </div>
      <div class="d-flex justify-content-center mt-5 mb-3">
        <b-pagination :total-rows="totalUserRows" :per-page="perUserPage" v-model="currentUserPage"/>
      </div>
    </b-card>
    <b-card class="text-left users">
      <h5>
        Pending Users
        <span class="user-count">
          {{ pendingUsers.length }} users
        </span>
      </h5>
      <div class="table-responsive">
        <b-table 
          hover
          :items="pendingUsers" 
          :fields="pendingHeaders" 
          :per-page="perPendingUserPage"
          :current-page="currentPendingUserPage"
          class="5 grey-table-head mb-5 mt-3">
          <template slot="_status" slot-scope="data">
            <div v-if="data.item.status=='pending'">
              <i class="fa fa-circle-o circle-orange mr-2"></i>
              Pending
            </div>
            <div v-if="data.item.status=='approved'">
              <i class="fa fa-circle-o circle-green mr-2"></i>
              Approved
            </div>
          </template>
          <template slot="kycResponse" slot-scope="data">
            <v-popover offset="" trigger="hover" placement="bottom">
              <b-link class="">Logs</b-link>
              <template slot="popover">
                <div class="response-header" v-if="data.item.response.length == 0">
                  No responses
                </div>
                <div class="response-header" v-if="data.item.response.length > 0">
                  <div class="d-flex justify-content-between" style="padding: 5px 0;">
                    <span>
                      Date
                    </span>
                    <span>
                      Status
                    </span>
                  </div>
                  <hr class="hr-white mt-0 mb-1">
                </div>
                <div class="response-wrapper mb-1">
                  <template v-for="response in data.item.response">
                    <div class="d-flex justify-content-between">
                      <template v-for="(object, key) in response">
                        <span v-if="key != 'date'">
                          {{ object }}
                        </span>
                        <span v-if="key == 'date'">
                          {{ object | dateFormat }}
                        </span>
                      </template>
                    </div>
                  </template>
                </div>
              </template>
            </v-popover>
          </template>
          <template slot="adminActions" slot-scope="data">
            <div class="d-inline-block mr-3">
              <b-button size="sm" class="green-btn">
                Approved
              </b-button>
            </div>
            <div class="d-inline-block">
              <b-button size="sm" variant="danger">
                Rejected
              </b-button>
            </div>
          </template>
          <template slot="userActions" slot-scope="data">
            <b-row>
              <b-col cols="8">
                <b-form-textarea 
                  placeholder="Remarks"
                  :rows="3"
                  :max-rows="3">              
                </b-form-textarea>
              </b-col>
              <b-col cols="4">
                <b-button size="sm" class="green-btn">
                  Submit
                </b-button>
              </b-col>
            </b-row>
          </template>
        </b-table>
      </div>
      <div class="d-flex justify-content-center mt-5 mb-3">
        <b-pagination :total-rows="totalPendingUserRows" :per-page="perPendingUserPage" v-model="currentPendingUserPage"/>
      </div>
    </b-card>
    <b-card class="text-left users">
      <h5>
        Referral Code Contributions
        <span class="user-count">
          {{ referralCodes.length }} Referral Codes
        </span>
      </h5>
      <div class="table-responsive">
        <b-table 
          hover
          :items="referralCodes" 
          :fields="referralHeaders" 
          :per-page="perReferralCodePage"
          :current-page="currentReferralCodePage"
          class="mt-3 grey-table-head mb-5">
          <template slot="vol" slot-scope="data">
            {{ data.item.referralVol | numFormat }} ETH
          </template>
          <template slot="comp" slot-scope="data">
            {{ data.item.compensation | numFormat }} ETH            
          </template>
        </b-table>
      </div>
      <div class="d-flex justify-content-center mt-5 mb-3">
        <b-pagination :total-rows="totalReferralCodeRows" :per-page="perReferralCodePage" v-model="currentReferralCodePage"/>
      </div>
    </b-card>
  </div>
</div>
